作为缓存数据库，一定要考虑缓存服务稳定性相关的保障机制。

持久化机制就是一种保障方式。持久化机制保证了Redis服务重启的情况下也不会损失（或者少量损失）数据，因为持久化会把内存中的数据存储到硬盘上，重启会从硬盘上加载数据。

redis集群模式有三种：

- 主从模式
- 哨兵模式
- Cluster集群模式

#### 主从模式

为了redis服务避免单节点故障，通常的做法是将redis数据复制多个副本以部署在不同的服务器上。这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。为此，redis提供了复制功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。

redis服务器分为两类，一类是主数据库（Master），一类是从数据库（Slave）。

​	主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。

​	从数据库一般是只读的，并接受主数据库同步过来的数据。主数据库和从数据库是一对多的关系。

优点：

- 一对多的关系，并且以非阻塞的方式完成数据同步
- 从服务器提供服务，分散主服务器压力，实现读写分离
- 从服务器之前可以彼此连接和同步请求，减少主服务同步压力

缺点：

- 不具备容错和恢复功能，主服务存在单点风险
- redis的主从复制采用全量复制，需要服务器有足够的空余内存
- 主从模式较难支持在线扩容

#### 哨兵模式

redis提供sentinel（哨兵）机制，通过sentinel模式启动redis后，自动监控Master/Slave的运行状态，基本原理就是：**心跳机制+投票裁决**。

简单来说，哨兵的作用就是监控redis系统的运行状况。功能包括两个：

- 监控主数据库和从数据库是否正常运行
- 主数据库出现故障时自动将从数据库转换为主数据库

哨兵模式主要有下面几个内容

- 监控：Sentinel会定期检查主从服务器是否处于正常工作状态
- 提醒：当被监控的某个redis服务器出现异常时，Sentinel可以通过API向管理员或者其他应用程序发送通知。
- 自动故障迁移：当一个主服务器不能正常工作时，Sentinel会开始一次自动故障迁移操作，它会使失效的主服务器的从服务器中升级一个成为主服务器，并让失效的主服务器的其他从服务器改为复制新的主服务器；当客户断尝试连接失败的主服务器时，集群也会想客户端返回新主服务器的地址，使得集群可以使用新主服务器代替失效服务器。

Redis Sentinel是一个分布式系统，你可以在一个架构中运行多个Sentinel进程（Progress）

优点：

- 哨兵模式主从可以切换，具备基本的故障转移能力
- 哨兵模式具备主从模式所有优点

缺点：

- 哨兵模式也很难支持在线扩容操作
- 集群的配置信息管理比较复杂

#### Cluster集群模式

redis Cluster是一种服务器Sharding技术，3.0版本开始正是提供。采用无中心结构，每个节点保存数据和整个集群状态，每个节点都和其他所有节点连接。

结构特点：

- 所有物理节点都映射到slot上，Cluster负责维护节点、桶、值之间的关系
- 所有节点彼此互相连接（PING-PONG机制），内部使用二进制协议及优化传输效率
- 超过半数的节点检测到某个节点失效时则判定该节点失效
- 使用端与redis节点连接，不需要中间Proxy层，可以直接操作，使用端不需要连接集群所有节点，连接集群中任何一个可用节点即可

优点：

- 无中心架构，节点间数据共享，可动态调整数据分布
- 节点可动态添加删除，扩展性比较灵活
- 部分节点异常，不影响整体集群的可用性

缺点：

- 集群实现比较复杂
- 批量操作指令（nget、nset等）支持有限
- 事务操作支持有限


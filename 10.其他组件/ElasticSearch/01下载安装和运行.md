### docker安装（推荐！强烈推荐）

- 下载ElasticSearch相关镜像

```
#搜索镜像
docker search -f "is-official=true" elasticsearch

#拉取镜像
docker pull elasticsearch:7.4.2

#运行
# -e 表示容器内部的环境变量
# discovery.type=single-node 设置为单节点运行
# -p 表示端口映射
# --name 设置容器名称
# -d 表示后台运行该容器，并返回容器的ID
docker run --name es -e "discovery.type=single-node" -p 9200:9200 -p 9300:9300 -d elasticsearch:7.4.2

#校验是否成功启动
curl http://192.168.73.134:9200
```

- 安装Kibana

```
# 查找镜像
docker search -f "is-official=true" kibana

# 下载镜像
docker pull kibana:7.4.2

#运行容器
docker run --name kibana -p 5601:5601 -d kibana:7.4.2

#查看ElasticSearch容器内ip
docker inspect es
找到IPAddress:后的ip

#进入kibana容器进行配置
docker exec -it kibana /bin/bash
vi config/kibana.yml
#修改elasticsearch.hosts: 后的elasticsearch为刚刚复制的ip
#并且追加如下配置
xpack.security.encryptionKey: "122333444455555666666777777788888888"
xpack.reporting.encryptionKey: "122333444455555666666777777788888888"

#可以追加如下配置，修改kibana为中文
i18n.locale: "zh-CN"

#重启docker
docker restart kibana

#访问
http://192.168.73.134:5601/
```





### 下载

下载地址：[elasticsearch-7.3.2-linux-x86_64.tar.gz](https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.2-linux-x86_64.tar.gz)

elasticsearch历史版本：https://www.elastic.co/cn/downloads/past-releases#elasticsearch
kibana历史版本：https://www.elastic.co/cn/downloads/past-releases#kibana

### 安装

```
#解压到当前目录
tar -zxf elasticsearch-7.3.2
#移动到/usr/local/es
mv -zxf elasticsearch-7.3.2 /usr/local/es
```

### 配置

- 修改ElasticSearch 应用的所有者：ElasticSearch不允许root用户启动，所以我们需要江ElasticSearch应用的所有者修改为其他用户。

  ```
  #修改es文件夹的所有者为test
  chown -R test.test /usr/local/es
  ```

- vi config/elasticsearch.yml

  ```
  增加： network.host: 0.0.0.0
  ```

### 启动

前台启动

```
cd /usr/local/es/bin
./elasticsecarcdarch

ctrl + c关闭
```

后台启动

```
/usr/local/es/bin/elasticsearch -d

后台关闭
#方法一
jps 命令查看 ElasticSearch 线程的编号kill -9 ElasticSearch 线程编号
#方法二：
ps -ef | grep elastic
kill -9 pid
```

浏览器访问ip:9200端口，如果能够看到一个json则表示访问成功，无法访问有可能是因为防火墙未开放9200端口

### 可能遇到的问题

ERROR: [3] bootstrap checks failed
[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]

```
vi /etc/security/limits.conf
追加如下内容：
* soft nofile 65536
* hard nofile 65536
```

[2]: memory locking requested for elasticsearch process but memory is not locked

```
vi /etc/sysctl.conf
#追加如下内容
vm.max_map_count=655360
#保存后执行
sysctl -p
```

[3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]

```
vim /etc/security/limits.d/90-nproc.conf 将2048改为4096或更大
```

[1]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured

```
vim config/elasticsearch.yml

#添加配置
discovery.seed_hosts: ["127.0.0.1"]
cluster.initial_master_nodes: ["node-1"]
```





## Kibana（最好和ElasticSearch相同版本）

- 官网下载：[Kibana](https://www.elastic.co/cn/downloads/kibana)

```
tar –zxvf kibana-7.3.2-linux-x86_64.tar.gz –C /run/
#给test用户赋权
cd /run/kibana-7.3.2-linux-x86_64/
chown -R test:test kibana-7.3.2-linux-x86_64
cd /run/kibana-7.3.2-linux-x86_64/config
vi kibana.yml
```

- 添加如下配置

  ```
  #配置本机ip
  server.port: 5601
  server.host: "192.168.73.134"
  
  #配置es集群url
  elasticsearch.hosts: ["http://192.168.73.134:9200"]
  ```

- 运行Kibana

```
cd ../bin
./kibana &
```



- wget下载并安装

```
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.3-x86_64.rpm

yum install -y localinstall kibana-7.17.3-x86_64.rpm
```

修改配置文件：

vi /etc/kibana/kibana.yml

```
#配置本机ip
server.host: "192.168.252.129"
#配置es集群url
elasticsearch.url: "http://192.168.252.129:9200"
```


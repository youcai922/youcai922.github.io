#### Redis常见问题

- 缓存穿透
- 缓存雪崩
- 缓存预热
- 缓存降级



#### 缓存穿透

一般访问缓存的流程，如果缓存中存在查询的数据，就直接返回，如果不存在，则访问数据库。

由于不恰当的业务功能实现，或者外部恶意攻击不断地请求不存在的数据内存，由于缓存中没有保存该数据，导致所有的请求都会落到数据库上，对数据库带来一定的压力，甚至崩溃。

**解决方案：**

针对缓存穿透的情况，简单的策略就是将不存在的数据访问结果，也存储到缓存中，避免缓存访问的穿透。最终不存在商品数据的访问结果也缓存下来。有效的避免缓存穿透风险。

#### 缓存雪崩

当缓存重启或者大量的缓存在某一时间段失效，这样就导致大批流量直接访问数据库，对DB造成压力，从而引起DB故障，系统崩溃。

简单来说，因为redis的信息存在时效性，如果大量数据在同一时间段失效，那么就会导致查询流量直接落在数据库上。对数据库造成十分大的压力。

**解决方案：**

- 将商品根据类别热度分类，购买比较多的类目缓存周期长一些，购买冷门的类目的商品，缓存周期短一些
- 在设置商品具体的缓存生效时间的时候，加上一个随机的区间引子，比如说5~10分钟之间来随意选择失效时间。
- 提前预估DB能力，如果缓存挂掉，数据库人可以一定程度上抗住流量的压力

#### 缓存预热

缓存预热就是系统上线之后，将相关的缓存数据直接加载到缓存系统。这样就可以避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题。

**解决方案：**

- 数据量不大的时候，工程启动的时候进行加载缓存动作
- 数据量大的时候，设置一个定时任务脚本，进行缓存的刷新
- 数据量太大的时候，优先保证热点数据进行提前加载到缓存

#### 缓存降级

降级的情况，就是缓存失效或者缓存服务挂掉的情况下，我门也不去访问数据库。我们直接访问内存部分数据缓存或者直接返回默认数据。

对于应用的首页，一般是访问量比较大的地方，首页里面往往包含了部分推荐商品的展示信息。这些推荐商品都会放到缓存中进行存储，同时我们为了避免缓存的异常情况，对热点商品页存储到了内存中。同时内存中还保留了一些默认的商品信息。

降级一般是有损的操作，所以精良避免、减少对于业务的影响程度




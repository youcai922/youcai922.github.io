#### MQ的作用：

- 解耦：将消息写入消息队列，需要消息的时候自己从消息队列中订阅，从而原系统不需要做任何修改。

- 异步：将消息写入消息队列，非必要的业务逻辑以异步的方式运行，加快响应速度

- 削峰：原系统慢慢的按照数据库能处理的并发量，从消息队列中慢慢拉取消息。在生产中，这个短暂的高峰期积压是允许的。

#### 缺点：

- 系统可用性降低
  系统引入的外部依赖越多，越容易挂掉。万一 MQ 挂了，MQ 一挂，整套系统崩溃，你不就完了？

- 系统复杂度提高（需要保证消息不会重复消费，消息是否丢失，消息传递顺序等等等等）

- 一致性问题
  A 系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是 BCD 三个系统那里，BD 两个系统写库成功了，结果 C 系统写库失败了，这个时候数据就不一致了。



#### 面对秒杀峰值的策略？

- 合法性限流：针对非正常请求（脚本）进行限流，添加验证码。多次购买同一件物品，并且购买间隔时间非常短，则判定为非正常请求，对其进行限流
- 负载限流：Nginx针对访问分发到不同的主机上进行处理，除此之外还有硬件负载
- Web服务器本身的限流：
  - 设置web服务器（tomcat）最大连接数
  - 设置token令牌生成数量，无令牌无法进行访问
- 消息队列：超过一定数量之后进入等待队列
- 缓存：将部分处理放到客户端

读峰值策略？写峰值策略？



#### RabbitMQ集群架构

https://www.jianshu.com/p/b7cc32b94d2a
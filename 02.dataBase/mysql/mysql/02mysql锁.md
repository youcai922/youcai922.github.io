### mysql锁

根据加锁的范围（锁的粒度），Mysql里面的锁大改分为三种，全局锁，表锁和行锁。MyISAM不支持行锁

##### 全局锁：给整个数据库进行加锁操作

```sql
flush table with read lock
```

给数据库进行全局加锁之后，无法进行数据修改，表的创建和修改、更新事务等操作

- 使用场景：做数据库全局备份操作。

- 缺点：
  - 如果在主数据库上加锁，则在加锁期间，无法进行更新操作，系统基本无法进行运作。
  - 如果备份从数据库，那么主从备份则会延迟，系统会存在数据不一致情况。



##### 表级锁：

表级锁有两种，一种是表锁，一种是元数据锁（MDL）

```sql
#加表锁
lock tables ... read/write
#释放表锁
unlock tables
```

lock tables t1 read,t2 write;如果执行该语句，则其他线程对t1表进行写操作和对t2表进行读写操作的时候，会进行阻塞

另外一种表级锁是MDL。MDL不用显式的使用，在对表访问操作的时候，MDL会自动加上。当对表进行增删改查的时候，会对表加MDL读锁，当对表进行结构变更的时候，会对表加MDL写锁。读锁和写锁以及写锁之间是互斥的，但读锁是不互斥的，所以可以有多个线程对表进行读写操作。

其实lock其实是对表中数据加锁，保证数据一致性。而MDL则是对表结构的加锁，保证表结构的一致性。

##### 行锁

操作的时候锁定当前行，开销大，加载慢，会出现死锁，粒度小，发生冲突概率低，并发高





按照锁的操作分为：共享锁和排他锁

- 共享锁：读锁，针对同一份数据，多个事务读取操作可以同时加锁而互不影响。但是无法修改数据
- 排他锁：写锁。当前操作没有完成前，会阻断其他操作的读取和写入



按照方式分为：乐观锁和悲观锁

- 乐观锁：读取的时候默认不会有修改操作。更新的时候会判断在此期间是否有其他线程更新数据
- 悲观锁：




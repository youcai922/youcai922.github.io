### 持久化机制

- RDB持久化：原理是将redis在内存中的数据库记录定时dump到磁盘上的RDB持久化
- ACF持久化：原理是将redis的操作日志以追加的方式写入文件

两者的区别：

RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程时fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。

ACF持久化是以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本方式记录，可以打开文件看到详细的操作记录。

RDB优点：

- RDB是紧凑的二进制文件，比较适合备份、全量复制等场景
- RDB恢复数据快于ACF

RDB缺点：

- RDB无法实现实时或者秒级持久化
- 新老版本无法兼容RDB格式

ACF优点：

- 可以更好的保护数据不丢失
- appen-only模式写入性能比较高
- 适合做灾难性的误删除紧急恢复

ACF缺点：

- 对于同一份文件，ACF文件要比RDB快照大
- ACF开启后，写的QPS会有所影响，相对于RDB来所，写QPS要下降
- 数据库恢复比较慢，不适合做冷备。

### 缓存失效策略

**定时删除策略：**

在设置key的过期时间的同时，为该key创建一个定时器，让定时器在key的过期时间来临时，对key进行删除

- 优点：保证内存尽快释放
- 缺点：若key过多，删除这些key会占用很多CPU时间，而且每个key创建一个定时器，性能影响严重。

**惰性删除策略：**

key过期的时候不删除，每次从数据库获取key的时候去检查是否过期，若过期，则删除，返回null

- 优点：CPU时间占用比较少
- 缺点：若key很长时间没有获取，将不会被删除，有可能导致内存泄露

**定时删除策略：**

每隔一段时间执行一次删除（在redis.conf配置文件中设置hz，ls刷新的频率）过期key的操作

- 优点可以控制删除操作的时长和频率，来减少CPU时间占用，避免惰性删除的时候内存泄露问题
- 缺点：
  - 对内存友好方面，不如定时策略
  - 对CPU友好方面，不如惰性策略

一般来说redis采用惰性策略+定时策略两个相结合

## 缓存命中率

命中：可以直接通过缓存获取到需要的数据

不命中：无法直接通过缓存获取想要的数据，需要再次查询数据库或者执行其他的操作。原因可能是由于缓存中根本不存在，或者缓存已经过期。

命中率越高表示缓存作用越好，性能越高（响应时间短，吞吐量高），并发能力也越好。

提高命中率：重点关注访问频率高且时效性相对较低的一些业务数据上，利用预加载（预热）、扩容、优化缓存粒度、更新缓存手段来提高命中率